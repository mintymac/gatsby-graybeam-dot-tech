# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Astro 5 static blog for Gray Beam Technology. Tailwind CSS 3 + @tailwindcss/typography, markdown content collections, deployed to Netlify.

## Development Commands

- `npm run dev` — dev server at http://localhost:4321
- `npm run build` — build to `/dist`
- `npm run preview` — preview built site
- `npx netlify deploy --dir=dist --no-build --prod` — deploy to Netlify (requires `gh auth switch --user mintymac` for GrayBeamTechnology org)

## Architecture

### Flat URL Namespace

Blog posts and static pages share the same `/{slug}/` URL space. The single `src/pages/[slug].astro` route collects both collections via `getStaticPaths()`, tags each with `type: "blog"` or `type: "page"`, and conditionally renders the appropriate layout. This means **slug collisions between posts and pages will break the build**.

Category listings live at `/category/{slugified-name}/` via `src/pages/category/[category].astro`.

### Layout System

`BaseLayout.astro` has a `wide` prop that controls content width:
- **Default (no `wide`):** Content is constrained to `max-w-3xl mx-auto` with padding — used by blog posts, pages, category listings, 404
- **`wide` mode:** Content fills the full viewport width with no constraints — used only by the homepage for full-bleed sections

`BlogPost.astro` wraps BaseLayout and adds: prose styling, author bio, PrevNext navigation, and the Giscus comment widget.

### Homepage (`index.astro`)

The most complex page (~280 lines). Key patterns:

**Blog image mapping:** A `blogImages` Record maps post slugs to `/images/blog-*.png` paths. When adding a new blog post, you must also add its hero image entry here or the post will render without a thumbnail on the homepage.

**Scroll reveals:** Elements with `data-reveal` attribute start hidden (`opacity: 0; translateY(20px)`) and animate in when scrolled into view. The `IntersectionObserver` script is inline at the bottom of the page; the CSS transitions are in `src/styles/global.css`.

**Hero prism:** The prism image uses `mask-image: radial-gradient(ellipse at center, black 35%, transparent 65%)` to soft-fade edges into the dark background. It has a floating animation (`prism-float` keyframes, 6s) and a purple drop shadow.

### Content Collections

Schemas in `src/content/config.ts`:
- **Blog:** title, category?, cover?, author?, date (coerced), draft (default false)
- **Pages:** title, menuTitle?, order?

Pages with a non-null `order` appear in header nav, sorted by that value.

### Color System

Only 3 brand purples are in `tailwind.config.mjs` (`brand.primary`, `brand.primary-light`, `brand.primary-dark`). All other brand colors (dark/light backgrounds, surfaces, borders, text hierarchy) are used as **hardcoded hex values** via Tailwind arbitrary values (e.g., `bg-[#0a0a0c]`, `text-[#b0b0c0]`). The full token reference is in `BRAND_IDENTITY.md`.

### Dark Mode

Class-based (`dark` class on `<html>`). A flash-prevention `is:inline` script in BaseLayout's `<head>` checks localStorage + `prefers-color-scheme` before first paint. `ThemeToggle.astro` handles runtime toggling and persistence.

### Site Data

`src/data/site.ts` — site metadata, author info (McHughson Chambers), social links, footer config.

## Adding Content

### New Blog Post

1. Create `src/content/blog/post-slug.md` with frontmatter:
   ```markdown
   ---
   title: "Post Title"
   category: "Engineering"
   author: "McHughson Chambers"
   date: 2026-01-01
   ---
   ```
2. Add a hero image to `public/images/blog-post-slug.png`
3. Add the slug → image mapping in `src/pages/index.astro` in the `blogImages` record
4. Categories should be capitalized: "Engineering", "Innovation", "Product"

### New Page

Create `src/content/pages/page-name.md`. Set `order` to include it in nav.

## Integrations

- **Pagefind** — client-side search, index built at `npm run build` time, UI loaded from `/pagefind/`
- **Giscus** — comment widget in `BlogPost.astro`, configured for `GrayBeamTechnology/graybeam-dot-tech` but `data-repo-id` and `data-category-id` are still empty (not functional)
- **RSS** — `src/pages/rss.xml.ts`
- **Sitemap** — auto-generated by `@astrojs/sitemap`
- **remark-gemoji** — `:emoji_name:` shortcodes in markdown

## Pending Work

- Giscus configuration — need to enable GitHub Discussions, fill in repo-id and category-id in `BlogPost.astro`
- Production SVG logo (current header logo is inline SVG approximation)
- README.md is outdated (still references Gatsby)
