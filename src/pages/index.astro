---
import BaseLayout from "../layouts/BaseLayout.astro";
import CategoryBadge from "../components/CategoryBadge.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const focusAreas = [
  {
    title: "Swarm Intelligence",
    desc: "Emergent coordination from simple agent rules",
    icon: `<circle cx="12" cy="12" r="2" fill="currentColor"/><circle cx="6" cy="8" r="1.5" fill="currentColor" opacity="0.6"/><circle cx="18" cy="8" r="1.5" fill="currentColor" opacity="0.6"/><circle cx="6" cy="16" r="1.5" fill="currentColor" opacity="0.6"/><circle cx="18" cy="16" r="1.5" fill="currentColor" opacity="0.6"/><line x1="6" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="0.5" opacity="0.4"/><line x1="18" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="0.5" opacity="0.4"/><line x1="6" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="0.5" opacity="0.4"/><line x1="18" y1="16" x2="12" y2="12" stroke="currentColor" stroke-width="0.5" opacity="0.4"/>`,
  },
  {
    title: "Biomimetics",
    desc: "Nature-inspired algorithms and architectures",
    icon: `<path d="M12 2C8 2 4 6 4 10c0 6 8 12 8 12s8-6 8-12c0-4-4-8-8-8z" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M12 6c-2 0-4 2-4 4 0 3 4 6 4 6s4-3 4-6c0-2-2-4-4-4z" fill="none" stroke="currentColor" stroke-width="1" opacity="0.5"/>`,
  },
  {
    title: "Constraint-Driven Dev",
    desc: "Using limitations as a creative forcing function",
    icon: `<rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="1.5" opacity="0.5"/><circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1"/>`,
  },
  {
    title: "AI Coordination",
    desc: "Multi-agent systems and orchestration patterns",
    icon: `<circle cx="6" cy="6" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/><circle cx="18" cy="6" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/><circle cx="12" cy="18" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="8" y1="7" x2="16" y2="7" stroke="currentColor" stroke-width="1" opacity="0.4"/><line x1="7" y1="8" x2="11" y2="16" stroke="currentColor" stroke-width="1" opacity="0.4"/><line x1="17" y1="8" x2="13" y2="16" stroke="currentColor" stroke-width="1" opacity="0.4"/>`,
  },
];

const projects = [
  {
    name: "AI Brand Studio",
    subtitle: "Generative brand identity pipeline",
    desc: "AI-powered brand exploration, logo generation, and design system extraction. From mood board to production tokens in minutes.",
    image: "/images/project-brand-studio.png",
    link: "#",
    linkText: "View project",
  },
  {
    name: "SportsCulture",
    subtitle: "sportsculture.io",
    desc: "Community-driven sports culture platform. Real-time event coordination powered by swarm scheduling algorithms.",
    image: "/images/project-sportsculture.png",
    link: "https://sportsculture.io",
    linkText: "Visit site",
  },
];

// Map blog slugs to generated thumbnail images
const blogImages: Record<string, string> = {
  "swarm-discovers-bottleneck-learning": "/images/blog-swarm-curriculum.png",
  "stigmergic-swarm-coordination": "/images/blog-stigmergic-coordination.png",
  "constraint-driven-development": "/images/blog-constraint-driven.png",
};
---

<BaseLayout wide>
  <!-- ═══════════════════════════════════════════ -->
  <!-- HERO -->
  <!-- ═══════════════════════════════════════════ -->
  <section class="relative overflow-hidden bg-[#0a0a0c] text-[#f0f0f2] py-24 sm:py-32">
    <!-- Geometric grid background -->
    <div class="hero-grid absolute inset-0 opacity-[0.04]" aria-hidden="true"></div>
    <!-- Radial glow behind prism -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-[#7c3cb7] rounded-full opacity-[0.06] blur-[120px]" aria-hidden="true"></div>

    <div class="relative max-w-5xl mx-auto px-4 sm:px-6 flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
      <!-- Text -->
      <div class="flex-1 text-center lg:text-left" data-reveal>
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight mb-6">
          Gray Beam<br />Technology
        </h1>
        <p class="text-lg sm:text-xl text-[#a0a0a8] max-w-lg mx-auto lg:mx-0 mb-8 leading-relaxed">
          A software think tank at the intersection of swarm intelligence,
          biomimetics, and AI coordination.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
          <a
            href="#work"
            class="inline-flex items-center justify-center px-6 py-3 bg-brand-primary text-white rounded font-semibold hover:bg-brand-primary-light transition-colors"
          >
            Explore our work
          </a>
          <a
            href="#research"
            class="inline-flex items-center justify-center px-6 py-3 border border-[#222332] text-[#a0a0a8] rounded font-semibold hover:border-[#7c3cb7] hover:text-[#f0f0f2] transition-colors"
          >
            Read research
          </a>
        </div>
      </div>

      <!-- Prism -->
      <div class="relative w-64 h-64 sm:w-80 sm:h-80 lg:w-[420px] lg:h-[420px] flex-shrink-0" data-reveal>
        <img
          src="/images/hero-prism.png"
          alt="Impossible Penrose triangle prism — white light enters, gray beams emerge"
          class="prism-img w-full h-full object-contain drop-shadow-[0_0_60px_rgba(124,60,183,0.25)]"
          loading="eager"
        />
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════ -->
  <!-- WHAT WE BUILD -->
  <!-- ═══════════════════════════════════════════ -->
  <section id="work" class="bg-white dark:bg-[#0a0a0c] py-20 sm:py-24">
    <div class="max-w-5xl mx-auto px-4 sm:px-6">
      <h2 class="text-sm font-semibold tracking-widest uppercase text-[#909098] dark:text-[#606068] mb-2" data-reveal>
        What We Build
      </h2>
      <p class="text-2xl sm:text-3xl font-bold text-[#121215] dark:text-[#f0f0f2] mb-12" data-reveal>
        Products born from research
      </p>

      <div class="grid sm:grid-cols-2 gap-6" data-reveal>
        {projects.map((project) => (
          <a
            href={project.link}
            class="group block overflow-hidden rounded bg-[#f5f5f7] dark:bg-[#121215] border border-[#d0d0d8] dark:border-[#222332] hover:border-brand-primary dark:hover:border-brand-primary transition-all duration-300 hover:-translate-y-0.5"
            target={project.link.startsWith("http") ? "_blank" : undefined}
            rel={project.link.startsWith("http") ? "noopener noreferrer" : undefined}
          >
            <div class="aspect-[16/9] overflow-hidden bg-[#0a0a0c]">
              <img
                src={project.image}
                alt=""
                class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500"
                loading="lazy"
              />
            </div>
            <div class="p-6 sm:p-8">
              <h3 class="text-xl font-bold text-[#121215] dark:text-[#f0f0f2] mb-1 group-hover:text-brand-primary dark:group-hover:text-brand-primary-light transition-colors">
                {project.name}
              </h3>
              <p class="text-sm text-brand-primary dark:text-brand-primary-light font-mono mb-3">
                {project.subtitle}
              </p>
              <p class="text-[#505058] dark:text-[#a0a0a8] text-sm leading-relaxed mb-4">
                {project.desc}
              </p>
              <span class="inline-flex items-center gap-1 text-sm font-semibold text-[#505058] dark:text-[#a0a0a8] group-hover:text-brand-primary dark:group-hover:text-brand-primary-light transition-colors">
                {project.linkText}
                <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </span>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════ -->
  <!-- HOW WE THINK -->
  <!-- ═══════════════════════════════════════════ -->
  <section class="bg-[#f5f5f7] dark:bg-[#121215] py-20 sm:py-24">
    <div class="max-w-5xl mx-auto px-4 sm:px-6">
      <h2 class="text-sm font-semibold tracking-widest uppercase text-[#909098] dark:text-[#606068] mb-2" data-reveal>
        How We Think
      </h2>
      <p class="text-2xl sm:text-3xl font-bold text-[#121215] dark:text-[#f0f0f2] mb-12" data-reveal>
        Research-driven, nature-inspired
      </p>

      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6" data-reveal>
        {focusAreas.map((area) => (
          <div class="group p-5 sm:p-6 rounded bg-white dark:bg-[#0a0a0c] border border-[#d0d0d8] dark:border-[#222332] hover:border-brand-primary dark:hover:border-brand-primary transition-colors">
            <svg viewBox="0 0 24 24" class="w-8 h-8 text-brand-primary dark:text-brand-primary-light mb-4" set:html={area.icon} />
            <h3 class="font-semibold text-[#121215] dark:text-[#f0f0f2] text-sm sm:text-base mb-1">
              {area.title}
            </h3>
            <p class="text-xs sm:text-sm text-[#909098] dark:text-[#606068] leading-relaxed">
              {area.desc}
            </p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════ -->
  <!-- LATEST RESEARCH -->
  <!-- ═══════════════════════════════════════════ -->
  <section id="research" class="bg-white dark:bg-[#0a0a0c] py-20 sm:py-24">
    <div class="max-w-5xl mx-auto px-4 sm:px-6">
      <h2 class="text-sm font-semibold tracking-widest uppercase text-[#909098] dark:text-[#606068] mb-2" data-reveal>
        Latest Research
      </h2>
      <p class="text-2xl sm:text-3xl font-bold text-[#121215] dark:text-[#f0f0f2] mb-12" data-reveal>
        From the lab
      </p>

      <div class="grid sm:grid-cols-3 gap-6" data-reveal>
        {posts.map((post) => (
          <a
            href={`/${post.slug}/`}
            class="group block overflow-hidden rounded bg-[#f5f5f7] dark:bg-[#121215] border border-[#d0d0d8] dark:border-[#222332] hover:border-brand-primary dark:hover:border-brand-primary transition-all duration-300 hover:-translate-y-0.5"
          >
            {blogImages[post.slug] && (
              <div class="aspect-[16/9] overflow-hidden bg-[#0a0a0c]">
                <img
                  src={blogImages[post.slug]}
                  alt=""
                  class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500"
                  loading="lazy"
                />
              </div>
            )}
            <div class="p-5">
              <div class="flex items-center gap-2 mb-3">
                <time
                  datetime={post.data.date.toISOString()}
                  class="text-xs text-[#909098] dark:text-[#606068]"
                >
                  {post.data.date.toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" })}
                </time>
                {post.data.category && <CategoryBadge category={post.data.category} />}
              </div>
              <h3 class="font-semibold text-[#121215] dark:text-[#f0f0f2] group-hover:text-brand-primary dark:group-hover:text-brand-primary-light transition-colors leading-snug">
                {post.data.title}
              </h3>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* Geometric grid background */
  .hero-grid {
    background-image:
      linear-gradient(rgba(124,60,183,0.3) 1px, transparent 1px),
      linear-gradient(90deg, rgba(124,60,183,0.3) 1px, transparent 1px);
    background-size: 60px 60px;
  }

  /* Prism image: soft-fade edges via mask, float animation */
  .prism-img {
    -webkit-mask-image: radial-gradient(ellipse at center, black 35%, transparent 65%);
    mask-image: radial-gradient(ellipse at center, black 35%, transparent 65%);
    animation: prism-float 6s ease-in-out infinite;
  }
  @keyframes prism-float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
  }
</style>

<script>
  // Scroll-triggered reveal animations
  const reveals = document.querySelectorAll("[data-reveal]");
  if (reveals.length > 0) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("revealed");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.15, rootMargin: "0px 0px -40px 0px" }
    );
    reveals.forEach((el) => observer.observe(el));
  }
</script>
